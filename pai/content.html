<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>ä¸–èˆˆDMæ–‡æ¡ˆå°å¹«æ‰‹</title>
    
    <meta property="og:title" content="ä¸–èˆˆDMæ–‡æ¡ˆå°å¹«æ‰‹">
    <meta property="og:description" content="æä¾›è¡Œç¨‹å»£å‘Šæ–‡æ¡ˆèˆ‡ç´ æä¸‹è¼‰ã€‚">
    <meta property="og:url" content="https://0917268665.github.io/DM/pai/content.html">
    <meta property="og:type" content="website">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        /* æ²¿ç”¨åŸæœ‰é…è‰²èˆ‡é¢¨æ ¼ */
        body { background-color: #f0f2f5; font-family: "Microsoft JhengHei", sans-serif; }
        .custom-header { background-color: #f37021; padding-top: 10px; padding-bottom: 15px; }
        .header-logo-container { width: 100%; text-align: center; margin-bottom: 10px; padding: 0 15px; }
        .header-logo { width: 100%; max-width: 400px; height: auto; object-fit: contain; }
        .header-title { font-size: 1.5rem; font-weight: bold; color: white; }
        .header-info { color: white; font-size: 0.9rem; line-height: 1.3; text-align: right; }
        
        /* åˆ—è¡¨å¡ç‰‡æ¨£å¼èª¿æ•´ï¼šå·¦åœ–å³æ–‡ */
        .copy-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            height: 100%;
        }
        .copy-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card-img-wrapper {
            width: 100%;
            height: 250px; /* æ‰‹æ©Ÿç‰ˆé«˜åº¦ */
            background-color: #eee;
            position: relative;
            overflow: hidden;
        }
        
        /* é›»è…¦ç‰ˆå·¦å´åœ–ç‰‡é«˜åº¦è¨­å®š */
        @media (min-width: 768px) {
            .card-img-wrapper {
                height: 100%;
                min-height: 280px; 
            }
        }

        .dm-img-main {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .copy-preview-text {
            display: -webkit-box;
            -webkit-line-clamp: 6; /* å¢åŠ é è¦½è¡Œæ•¸ */
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: #555;
            font-size: 1rem;
            white-space: pre-wrap; 
            line-height: 1.6;
        }

        /* å½ˆçª—æ¨£å¼ */
        .modal-header { background: #2c3e50; color: white; }
        .modal-title { font-weight: bold; }
        
        .copy-content-box {
            background-color: #f8f9fa;
            border: 1px dashed #ccc;
            padding: 15px;
            border-radius: 5px;
            font-size: 0.95rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        /* ç´ æåœ–ç‰‡æ ¼ç·š (æ¯æ’å…©å¼µ) */
        .asset-img-container {
            width: 100%;
            aspect-ratio: 4/3;
            background: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
            border: 1px solid #ddd;
        }
        .asset-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        .asset-img:hover {
            transform: scale(1.05);
        }

        /* ä¸‹æ‹‰é¸å–®æ¨£å¼å„ªåŒ– */
        .dropdown-item { padding: 10px 20px; border-bottom: 1px solid #eee; }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background-color: #f8f9fa; color: #f37021; }

    </style>
</head>
<body>

<header class="custom-header shadow-sm mb-4">
    <div class="header-logo-container">
        <img src="../logo.png" alt="æ–°é­…åŠ›æ—…éŠ Logo" class="header-logo" onerror="this.style.display='none';">
    </div>
    
    <div class="container">
        <div class="d-flex justify-content-between align-items-end mb-2">
            <div class="header-title">
                ğŸ“ ä¸–èˆˆDMæ–‡æ¡ˆå°å¹«æ‰‹
            </div>
            
            <div class="header-info d-flex align-items-center">
                <div class="me-2">
                    <div>æ¥­å‹™ï¼šé™³å½¥ç™¾(ç™¾ç™¾)</div>
                    <div>æ‰‹æ©Ÿï¼š0917268665</div>
                </div>
                <a href="https://line.me/ti/p/I_O5--_4ks" target="_blank">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" alt="LINE" height="36">
                </a>
            </div>
        </div>

        <div class="text-center mt-3">
            <a href="https://0917268665.github.io/DM/pai/maker.html" target="_blank" class="btn btn-light text-danger fw-bold w-100 shadow-sm" style="border-radius: 50px;">
                âœ¨ é»æˆ‘å‰å¾€è²¼æ¨™ç¥å™¨ âœ¨
            </a>
        </div>
    </div>
</header>

<!-- å…§å®¹å€ -->
<div class="container mb-5">
    <div class="row g-4" id="copy-list">
        <div class="col-12 text-center py-5">
            <div class="spinner-border text-secondary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">æ­£åœ¨è®€å–æ–‡æ¡ˆè³‡æ–™...</p>
        </div>
    </div>
</div>

<!-- è©³æƒ…å½ˆçª— (Modal) -->
<div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="m-title">æ¨™é¡Œ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                
                <!-- æŒ‰éˆ•å€ï¼šDMä¸‹è¼‰ã€Wordä¸‹è¼‰(å¤šæª”æ¡ˆé‚è¼¯)ã€è²¼æ¨™ç¥å™¨ -->
                <div class="d-flex flex-wrap gap-2 mb-1 justify-content-end" id="m-action-area">
                    <!-- JS å‹•æ…‹ç”ŸæˆæŒ‰éˆ• -->
                </div>
                
                <!-- æ–°å¢ï¼šæç¤ºæ–‡å­— -->
                <div class="text-end mb-3">
                    <small class="text-muted" style="font-size: 0.8rem;">(å¦‚éœ€åˆæˆæ‚¨çš„logoåº•æ¨™ï¼Œè«‹å‰å¾€è²¼æ¨™ç¥å™¨)</small>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="fw-bold mb-0"><i class="bi bi-text-left"></i> å»£å‘Šæ–‡æ¡ˆ</h6>
                    <button class="btn btn-sm btn-dark" onclick="copyText()">
                        <i class="bi bi-clipboard"></i> ä¸€éµè¤‡è£½æ–‡æ¡ˆ
                    </button>
                </div>
                <div class="copy-content-box mb-4" id="m-full-text"></div>

                <hr>

                <h6 class="fw-bold mb-3"><i class="bi bi-images"></i> è¡Œç¨‹ç´ æåœ–ç‰‡</h6>
                <div class="row g-3" id="m-assets-container"></div>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
            </div>
        </div>
    </div>
</div>

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
  <div id="copyToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        <i class="bi bi-check-circle-fill me-2"></i> æ–‡æ¡ˆå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // ================= è¨­å®šå€ =================
    // æ›´æ–°ç‚ºæ‚¨æä¾›çš„æ­£ç¢ºé€£çµ (åŒ…å« gid=...)
    const googleSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTcPCobeix2WBU69fxSbx9IKFJpPtP04dutrcHp-KV8L1vnAEcUErx-x0zfGbBBYaUWtzgR-ZZR6W6B/pub?gid=1046620833&single=true&output=csv";
    // =========================================

    let ALL_DATA = [];

    const listContainer = document.getElementById('copy-list');
    const modal = new bootstrap.Modal(document.getElementById('detailModal'));
    const toast = new bootstrap.Toast(document.getElementById('copyToast'));

    document.addEventListener("DOMContentLoaded", function() {
        fetchData();
    });

    function fetchData() {
        Papa.parse(googleSheetUrl, {
            download: true,
            header: true,
            complete: function(results) {
                // è³‡æ–™è™•ç†é‚è¼¯
                // ç‚ºäº†ä¿éšªèµ·è¦‹ï¼Œå…ˆæŠŠç©ºè¡Œéæ¿¾æ‰
                ALL_DATA = results.data
                    .filter(item => {
                        // ç°¡å–®æª¢æŸ¥ä¸€ä¸‹ï¼šå¿…é ˆè¦æœ‰ id æˆ– titleï¼Œæ‰ç®—æœ‰æ•ˆè³‡æ–™
                        return item.id || item.title;
                    })
                    .map(item => {
                        // --- è™•ç†å¤šæª”æ¡ˆä¸‹è¼‰é‚è¼¯ ---
                        let docFiles = [];
                        
                        // 1. æª¢æŸ¥æ–°ç‰ˆæ¬„ä½ doc_link_1 ~ 10
                        for(let i=1; i<=10; i++){
                            const link = item[`doc_link_${i}`];
                            const name = item[`doc_name_${i}`];
                            if(link && link.trim() !== "") {
                                docFiles.push({
                                    name: name || `è¡Œç¨‹ ${i}`,
                                    url: link.trim()
                                });
                            }
                        }

                        // 2. å¦‚æœéƒ½æ²’æœ‰æ–°ç‰ˆæ¬„ä½ï¼Œæª¢æŸ¥èˆŠç‰ˆ doc_link ä½œç‚ºç›¸å®¹
                        if(docFiles.length === 0 && item.doc_link && item.doc_link.trim() !== "") {
                            docFiles.push({
                                name: "ä¸‹è¼‰è¡Œç¨‹ Word",
                                url: item.doc_link.trim()
                            });
                        }

                        return {
                            ...item,
                            // ç´ æåœ–ç‰‡å­—ä¸²è½‰é™£åˆ—
                            assetsArray: item.assets ? item.assets.split(',').map(url => url.trim()).filter(url => url !== "") : [],
                            // æ•´ç†å¾Œçš„æª”æ¡ˆåˆ—è¡¨
                            docFiles: docFiles
                        };
                    });
                
                // å†æ¬¡ç¢ºèªæœ‰æ²’æœ‰è³‡æ–™
                if (ALL_DATA.length === 0 && results.data.length > 0) {
                     // å¦‚æœåŸå§‹ results æœ‰è³‡æ–™ï¼Œä½† filter å¾Œå…¨æ²’äº†ï¼Œå¯èƒ½æ˜¯æ¬„ä½åç¨±å•é¡Œ
                     console.warn("åŸå§‹è³‡æ–™æœ‰å…§å®¹ï¼Œä½†éæ¿¾å¾Œç‚ºç©ºï¼Œè«‹æª¢æŸ¥ CSV æ¬„ä½åç¨±æ˜¯å¦æ­£ç¢º (id, title ç­‰)ã€‚");
                }

                renderList();
            },
            error: function(err) {
                console.error("Error:", err);
                listContainer.innerHTML = `<div class="col-12 text-center text-danger">
                    <h4>è®€å–è³‡æ–™å¤±æ•—</h4>
                    <p>è«‹ç¢ºèªæ‚¨çš„ Google Sheet é€£çµæ¬Šé™æ˜¯å¦å…¬é–‹ï¼Œæˆ–é€£çµæ˜¯å¦æ­£ç¢ºã€‚</p>
                </div>`;
            }
        });
    }

    // æ¸²æŸ“åˆ—è¡¨
    function renderList() {
        listContainer.innerHTML = "";

        if (ALL_DATA.length === 0) {
            listContainer.innerHTML = `<div class="col-12 text-center text-muted py-5">æš«ç„¡è³‡æ–™ (è«‹æª¢æŸ¥ Google Sheet å…§å®¹èˆ‡æ¬Šé™)</div>`;
            return;
        }

        ALL_DATA.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'col-12'; 
            
            div.innerHTML = `
                <div class="copy-card" onclick="openDetail(${index})">
                    <div class="row g-0 h-100">
                        <!-- åœ–ç‰‡å€å¡Š -->
                        <div class="col-md-4 col-xl-3">
                            <div class="card-img-wrapper">
                                <img src="${item.dm_img || 'https://via.placeholder.com/400x300?text=No+Image'}" class="dm-img-main" alt="${item.title}">
                            </div>
                        </div>
                        <!-- æ–‡å­—å€å¡Š -->
                        <div class="col-md-8 col-xl-9">
                            <div class="card-body h-100 d-flex flex-column p-4">
                                <div class="mb-2">
                                    <span class="badge bg-primary">${item.category || 'ç²¾é¸'}</span>
                                    <small class="text-muted ms-1">${item.id}</small>
                                </div>
                                <h4 class="card-title fw-bold mb-3">${item.title}</h4>
                                <div class="copy-preview-text flex-grow-1 mb-3">
                                    ${item.content || '(ç„¡æ–‡æ¡ˆå…§å®¹)'}
                                </div>
                                <div class="mt-auto text-end">
                                    <button class="btn btn-outline-secondary stretched-link">
                                        æŸ¥çœ‹å®Œæ•´å…§å®¹ & ä¸‹è¼‰
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            listContainer.appendChild(div);
        });
    }

    function openDetail(index) {
        const item = ALL_DATA[index];
        
        document.getElementById('m-title').innerText = item.title;
        document.getElementById('m-full-text').innerText = item.content || '';
        
        // --- å‹•æ…‹ç”ŸæˆæŒ‰éˆ•å€ ---
        const actionArea = document.getElementById('m-action-area');
        actionArea.innerHTML = '';

        // 1. Word è¡Œç¨‹ä¸‹è¼‰ (èª¿åˆ°ç¬¬ä¸€å€‹)
        if (item.docFiles && item.docFiles.length > 0) {
            if (item.docFiles.length === 1) {
                // åªæœ‰ä¸€å€‹æª”æ¡ˆï¼šç›´æ¥é¡¯ç¤ºæŒ‰éˆ•
                const file = item.docFiles[0];
                actionArea.innerHTML += `
                    <a href="${file.url}" target="_blank" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-file-word"></i> ${file.name}
                    </a>
                `;
            } else {
                // æœ‰å¤šå€‹æª”æ¡ˆï¼šé¡¯ç¤ºä¸‹æ‹‰é¸å–®
                let dropdownHtml = `
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-folder-symlink"></i> ä¸‹è¼‰ Word (å…±${item.docFiles.length}ç¨®)
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                `;
                
                item.docFiles.forEach(file => {
                    dropdownHtml += `
                        <li><a class="dropdown-item" href="${file.url}" target="_blank">
                            <i class="bi bi-file-earmark-word me-2"></i>${file.name}
                        </a></li>
                    `;
                });

                dropdownHtml += `</ul></div>`;
                actionArea.innerHTML += dropdownHtml;
            }
        } else {
             // è‹¥ç„¡è¡Œç¨‹æª”ï¼Œé¡¯ç¤º disable ç‹€æ…‹çš„æŒ‰éˆ•ä½”ä½ (é¸ç”¨)
             actionArea.innerHTML += `
                <a href="#" class="btn btn-outline-primary btn-sm disabled">
                    <i class="bi bi-file-word"></i> ç„¡è¡Œç¨‹æª”
                </a>
            `;
        }

        // 2. DM ä¸‹è¼‰æŒ‰éˆ• (èª¿åˆ°ç¬¬äºŒå€‹)
        const dmLink = (item.dm_img && item.dm_img.trim() !== "") ? item.dm_img : "#";
        const dmDisabled = (dmLink === "#") ? "disabled" : "";
        const dmTarget = (dmLink === "#") ? "" : `target="_blank"`;

        actionArea.innerHTML += `
            <a href="${dmLink}" ${dmTarget} class="btn btn-outline-danger btn-sm ${dmDisabled}">
                <i class="bi bi-image"></i> ä¸‹è¼‰DM
            </a>
        `;

        // 3. è²¼æ¨™ç¥å™¨é€£çµ (ç¬¬ä¸‰å€‹)
        actionArea.innerHTML += `
            <a href="https://0917268665.github.io/DM/pai/maker.html" target="_blank" class="btn btn-outline-success btn-sm">
                <i class="bi bi-magic"></i> è²¼æ¨™ç¥å™¨
            </a>
        `;

        // --- è™•ç†ç´ æåœ–ç‰‡ ---
        const assetContainer = document.getElementById('m-assets-container');
        assetContainer.innerHTML = "";
        
        if (item.assetsArray && item.assetsArray.length > 0) {
            item.assetsArray.forEach(imgUrl => {
                const col = document.createElement('div');
                col.className = 'col-6'; 
                col.innerHTML = `
                    <div class="asset-img-container">
                        <a href="${imgUrl}" target="_blank">
                            <img src="${imgUrl}" class="asset-img" loading="lazy">
                        </a>
                    </div>
                `;
                assetContainer.appendChild(col);
            });
        } else {
            assetContainer.innerHTML = '<div class="col-12 text-center text-muted">ç„¡ç´ æåœ–ç‰‡</div>';
        }

        modal.show();
    }

    function copyText() {
        const text = document.getElementById('m-full-text').innerText;
        navigator.clipboard.writeText(text).then(() => {
            toast.show();
        }).catch(err => {
            console.error('è¤‡è£½å¤±æ•—:', err);
            alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
        });
    }

</script>
</body>
</html>